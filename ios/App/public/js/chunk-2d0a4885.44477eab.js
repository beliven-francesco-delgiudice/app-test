(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0a4885"],{"079a":function(t,e,i){"use strict";i.r(e),i.d(e,"FilesystemWeb",(function(){return a}));var r=i("1547");function o(t){const e=t.split("/").filter(t=>"."!==t),i=[];return e.forEach(t=>{".."===t&&i.length>0&&".."!==i[i.length-1]?i.pop():i.push(t)}),i.join("/")}function s(t,e){t=o(t),e=o(e);const i=t.split("/"),r=e.split("/");return t!==e&&i.every((t,e)=>t===r[e])}class a extends r["b"]{constructor(){super(...arguments),this.DB_VERSION=1,this.DB_NAME="Disc",this._writeCmds=["add","put","delete"]}async initDb(){if(void 0!==this._db)return this._db;if(!("indexedDB"in window))throw this.unavailable("This browser doesn't support IndexedDB");return new Promise((t,e)=>{const i=indexedDB.open(this.DB_NAME,this.DB_VERSION);i.onupgradeneeded=a.doUpgrade,i.onsuccess=()=>{this._db=i.result,t(i.result)},i.onerror=()=>e(i.error),i.onblocked=()=>{console.warn("db blocked")}})}static doUpgrade(t){const e=t.target,i=e.result;switch(t.oldVersion){case 0:case 1:default:{i.objectStoreNames.contains("FileStorage")&&i.deleteObjectStore("FileStorage");const t=i.createObjectStore("FileStorage",{keyPath:"path"});t.createIndex("by_folder","folder")}}}async dbRequest(t,e){const i=-1!==this._writeCmds.indexOf(t)?"readwrite":"readonly";return this.initDb().then(r=>new Promise((o,s)=>{const a=r.transaction(["FileStorage"],i),n=a.objectStore("FileStorage"),c=n[t](...e);c.onsuccess=()=>o(c.result),c.onerror=()=>s(c.error)}))}async dbIndexRequest(t,e,i){const r=-1!==this._writeCmds.indexOf(e)?"readwrite":"readonly";return this.initDb().then(o=>new Promise((s,a)=>{const n=o.transaction(["FileStorage"],r),c=n.objectStore("FileStorage"),d=c.index(t),h=d[e](...i);h.onsuccess=()=>s(h.result),h.onerror=()=>a(h.error)}))}getPath(t,e){const i=void 0!==e?e.replace(/^[/]+|[/]+$/g,""):"";let r="";return void 0!==t&&(r+="/"+t),""!==e&&(r+="/"+i),r}async clear(){const t=await this.initDb(),e=t.transaction(["FileStorage"],"readwrite"),i=e.objectStore("FileStorage");i.clear()}async readFile(t){const e=this.getPath(t.directory,t.path),i=await this.dbRequest("get",[e]);if(void 0===i)throw Error("File does not exist.");return{data:i.content?i.content:""}}async writeFile(t){const e=this.getPath(t.directory,t.path);let i=t.data;const r=t.encoding,o=t.recursive,s=await this.dbRequest("get",[e]);if(s&&"directory"===s.type)throw Error("The supplied path is a directory.");const a=e.substr(0,e.lastIndexOf("/")),n=await this.dbRequest("get",[a]);if(void 0===n){const e=a.indexOf("/",1);if(-1!==e){const i=a.substr(e);await this.mkdir({path:i,directory:t.directory,recursive:o})}}if(!r&&(i=i.indexOf(",")>=0?i.split(",")[1]:i,!this.isBase64String(i)))throw Error("The supplied data is not valid base64 content.");const c=Date.now(),d={path:e,folder:a,type:"file",size:i.length,ctime:c,mtime:c,content:i};return await this.dbRequest("put",[d]),{uri:d.path}}async appendFile(t){const e=this.getPath(t.directory,t.path);let i=t.data;const r=t.encoding,o=e.substr(0,e.lastIndexOf("/")),s=Date.now();let a=s;const n=await this.dbRequest("get",[e]);if(n&&"directory"===n.type)throw Error("The supplied path is a directory.");const c=await this.dbRequest("get",[o]);if(void 0===c){const e=o.indexOf("/",1);if(-1!==e){const i=o.substr(e);await this.mkdir({path:i,directory:t.directory,recursive:!0})}}if(!r&&!this.isBase64String(i))throw Error("The supplied data is not valid base64 content.");void 0!==n&&(i=void 0===n.content||r?n.content+i:btoa(atob(n.content)+atob(i)),a=n.ctime);const d={path:e,folder:o,type:"file",size:i.length,ctime:a,mtime:s,content:i};await this.dbRequest("put",[d])}async deleteFile(t){const e=this.getPath(t.directory,t.path),i=await this.dbRequest("get",[e]);if(void 0===i)throw Error("File does not exist.");const r=await this.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(e)]);if(0!==r.length)throw Error("Folder is not empty.");await this.dbRequest("delete",[e])}async mkdir(t){const e=this.getPath(t.directory,t.path),i=t.recursive,r=e.substr(0,e.lastIndexOf("/")),o=(e.match(/\//g)||[]).length,s=await this.dbRequest("get",[r]),a=await this.dbRequest("get",[e]);if(1===o)throw Error("Cannot create Root directory");if(void 0!==a)throw Error("Current directory does already exist.");if(!i&&2!==o&&void 0===s)throw Error("Parent directory must exist");if(i&&2!==o&&void 0===s){const e=r.substr(r.indexOf("/",1));await this.mkdir({path:e,directory:t.directory,recursive:i})}const n=Date.now(),c={path:e,folder:r,type:"directory",size:0,ctime:n,mtime:n};await this.dbRequest("put",[c])}async rmdir(t){const{path:e,directory:i,recursive:r}=t,o=this.getPath(i,e),s=await this.dbRequest("get",[o]);if(void 0===s)throw Error("Folder does not exist.");if("directory"!==s.type)throw Error("Requested path is not a directory");const a=await this.readdir({path:e,directory:i});if(0!==a.files.length&&!r)throw Error("Folder is not empty");for(const n of a.files){const t=`${e}/${n.name}`,o=await this.stat({path:t,directory:i});"file"===o.type?await this.deleteFile({path:t,directory:i}):await this.rmdir({path:t,directory:i,recursive:r})}await this.dbRequest("delete",[o])}async readdir(t){const e=this.getPath(t.directory,t.path),i=await this.dbRequest("get",[e]);if(""!==t.path&&void 0===i)throw Error("Folder does not exist.");const r=await this.dbIndexRequest("by_folder","getAllKeys",[IDBKeyRange.only(e)]),o=await Promise.all(r.map(async t=>{let i=await this.dbRequest("get",[t]);return void 0===i&&(i=await this.dbRequest("get",[t+"/"])),{name:t.substring(e.length+1),type:i.type,size:i.size,ctime:i.ctime,mtime:i.mtime,uri:i.path}}));return{files:o}}async getUri(t){const e=this.getPath(t.directory,t.path);let i=await this.dbRequest("get",[e]);return void 0===i&&(i=await this.dbRequest("get",[e+"/"])),{uri:(null===i||void 0===i?void 0:i.path)||e}}async stat(t){const e=this.getPath(t.directory,t.path);let i=await this.dbRequest("get",[e]);if(void 0===i&&(i=await this.dbRequest("get",[e+"/"])),void 0===i)throw Error("Entry does not exist.");return{type:i.type,size:i.size,ctime:i.ctime,mtime:i.mtime,uri:i.path}}async rename(t){await this._copy(t,!0)}async copy(t){return this._copy(t,!1)}async requestPermissions(){return{publicStorage:"granted"}}async checkPermissions(){return{publicStorage:"granted"}}async _copy(t,e=!1){let{toDirectory:i}=t;const{to:r,from:o,directory:a}=t;if(!r||!o)throw Error("Both to and from must be provided");i||(i=a);const n=this.getPath(a,o),c=this.getPath(i,r);if(n===c)return{uri:c};if(s(n,c))throw Error("To path cannot contain the from path");let d;try{d=await this.stat({path:r,directory:i})}catch(y){const t=r.split("/");t.pop();const e=t.join("/");if(t.length>0){const t=await this.stat({path:e,directory:i});if("directory"!==t.type)throw new Error("Parent directory of the to path is a file")}}if(d&&"directory"===d.type)throw new Error("Cannot overwrite a directory with a file");const h=await this.stat({path:o,directory:a}),l=async(t,e,r)=>{const o=this.getPath(i,t),s=await this.dbRequest("get",[o]);s.ctime=e,s.mtime=r,await this.dbRequest("put",[s])},u=h.ctime?h.ctime:Date.now();switch(h.type){case"file":{const t=await this.readFile({path:o,directory:a});e&&await this.deleteFile({path:o,directory:a});const s=await this.writeFile({path:r,directory:i,data:t.data});return e&&await l(r,u,h.mtime),s}case"directory":{if(d)throw Error("Cannot move a directory over an existing object");try{await this.mkdir({path:r,directory:i,recursive:!1}),e&&await l(r,u,h.mtime)}catch(y){}const t=(await this.readdir({path:o,directory:a})).files;for(const s of t)await this._copy({from:`${o}/${s}`,to:`${r}/${s}`,directory:a,toDirectory:i},e);e&&await this.rmdir({path:o,directory:a})}}return{uri:c}}isBase64String(t){try{return btoa(atob(t))==t}catch(e){return!1}}}a._debug=!0}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGNhcGFjaXRvci9maWxlc3lzdGVtL2Rpc3QvZXNtL3dlYi5qcyJdLCJuYW1lcyI6WyJyZXNvbHZlIiwicGF0aCIsInBvc2l4Iiwic3BsaXQiLCJmaWx0ZXIiLCJpdGVtIiwibmV3UG9zaXgiLCJmb3JFYWNoIiwibGVuZ3RoIiwicG9wIiwicHVzaCIsImpvaW4iLCJpc1BhdGhQYXJlbnQiLCJwYXJlbnQiLCJjaGlsZHJlbiIsInBhdGhzQSIsInBhdGhzQiIsImV2ZXJ5IiwidmFsdWUiLCJpbmRleCIsIkZpbGVzeXN0ZW1XZWIiLCJzdXBlciIsImFyZ3VtZW50cyIsInRoaXMiLCJEQl9WRVJTSU9OIiwiREJfTkFNRSIsIl93cml0ZUNtZHMiLCJ1bmRlZmluZWQiLCJfZGIiLCJ3aW5kb3ciLCJ1bmF2YWlsYWJsZSIsIlByb21pc2UiLCJyZWplY3QiLCJyZXF1ZXN0IiwiaW5kZXhlZERCIiwib3BlbiIsIm9udXBncmFkZW5lZWRlZCIsImRvVXBncmFkZSIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJlcnJvciIsIm9uYmxvY2tlZCIsImNvbnNvbGUiLCJ3YXJuIiwiZXZlbnQiLCJldmVudFRhcmdldCIsInRhcmdldCIsImRiIiwib2xkVmVyc2lvbiIsIm9iamVjdFN0b3JlTmFtZXMiLCJjb250YWlucyIsImRlbGV0ZU9iamVjdFN0b3JlIiwic3RvcmUiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsImNtZCIsImFyZ3MiLCJyZWFkRmxhZyIsImluZGV4T2YiLCJpbml0RGIiLCJ0aGVuIiwiY29ubiIsInR4IiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsInJlcSIsImluZGV4TmFtZSIsImRpcmVjdG9yeSIsInVyaVBhdGgiLCJjbGVhbmVkVXJpUGF0aCIsInJlcGxhY2UiLCJmc1BhdGgiLCJjbGVhciIsIm9wdGlvbnMiLCJnZXRQYXRoIiwiZW50cnkiLCJkYlJlcXVlc3QiLCJFcnJvciIsImRhdGEiLCJjb250ZW50IiwiZW5jb2RpbmciLCJkb1JlY3Vyc2l2ZSIsInJlY3Vyc2l2ZSIsIm9jY3VwaWVkRW50cnkiLCJ0eXBlIiwicGFyZW50UGF0aCIsInN1YnN0ciIsImxhc3RJbmRleE9mIiwicGFyZW50RW50cnkiLCJzdWJEaXJJbmRleCIsInBhcmVudEFyZ1BhdGgiLCJta2RpciIsImlzQmFzZTY0U3RyaW5nIiwibm93IiwiRGF0ZSIsInBhdGhPYmoiLCJmb2xkZXIiLCJzaXplIiwiY3RpbWUiLCJtdGltZSIsInVyaSIsImJ0b2EiLCJhdG9iIiwiZW50cmllcyIsImRiSW5kZXhSZXF1ZXN0IiwiSURCS2V5UmFuZ2UiLCJvbmx5IiwiZGVwdGgiLCJtYXRjaCIsImZ1bGxQYXRoIiwicmVhZERpclJlc3VsdCIsInJlYWRkaXIiLCJmaWxlcyIsImVudHJ5UGF0aCIsIm5hbWUiLCJlbnRyeU9iaiIsInN0YXQiLCJkZWxldGVGaWxlIiwicm1kaXIiLCJhbGwiLCJtYXAiLCJhc3luYyIsImUiLCJzdWJFbnRyeSIsInN1YnN0cmluZyIsIl9jb3B5IiwicHVibGljU3RvcmFnZSIsImRvUmVuYW1lIiwidG9EaXJlY3RvcnkiLCJ0byIsImZyb20iLCJmcm9tRGlyZWN0b3J5IiwiZnJvbVBhdGgiLCJ0b1BhdGgiLCJ0b09iaiIsInRvUGF0aENvbXBvbmVudHMiLCJ0b1BhcmVudERpcmVjdG9yeSIsImZyb21PYmoiLCJ1cGRhdGVUaW1lIiwiZmlsZSIsInJlYWRGaWxlIiwid3JpdGVSZXN1bHQiLCJ3cml0ZUZpbGUiLCJjb250ZW50cyIsImZpbGVuYW1lIiwic3RyIiwiZXJyIiwiX2RlYnVnIl0sIm1hcHBpbmdzIjoia0hBQUEscUVBQ0EsU0FBU0EsRUFBUUMsR0FDYixNQUFNQyxFQUFRRCxFQUFLRSxNQUFNLEtBQUtDLE9BQU9DLEdBQWlCLE1BQVRBLEdBQ3ZDQyxFQUFXLEdBV2pCLE9BVkFKLEVBQU1LLFFBQVFGLElBQ0csT0FBVEEsR0FDQUMsRUFBU0UsT0FBUyxHQUNnQixP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QUtpQyxHQUdiLGVBQWVZLEdBQ1gsSUFDSSxPQUFPNUMsS0FBS0MsS0FBSzJDLEtBQVNBLEVBRTlCLE1BQU9DLEdBQ0gsT0FBTyxJQUluQmhJLEVBQWNpSSxRQUFTIiwiZmlsZSI6ImpzL2NodW5rLTJkMGE0ODg1LjQ0NDc3ZWFiLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgV2ViUGx1Z2luIH0gZnJvbSAnQGNhcGFjaXRvci9jb3JlJztcbmZ1bmN0aW9uIHJlc29sdmUocGF0aCkge1xuICAgIGNvbnN0IHBvc2l4ID0gcGF0aC5zcGxpdCgnLycpLmZpbHRlcihpdGVtID0+IGl0ZW0gIT09ICcuJyk7XG4gICAgY29uc3QgbmV3UG9zaXggPSBbXTtcbiAgICBwb3NpeC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBpZiAoaXRlbSA9PT0gJy4uJyAmJlxuICAgICAgICAgICAgbmV3UG9zaXgubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgbmV3UG9zaXhbbmV3UG9zaXgubGVuZ3RoIC0gMV0gIT09ICcuLicpIHtcbiAgICAgICAgICAgIG5ld1Bvc2l4LnBvcCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbmV3UG9zaXgucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBuZXdQb3NpeC5qb2luKCcvJyk7XG59XG5mdW5jdGlvbiBpc1BhdGhQYXJlbnQocGFyZW50LCBjaGlsZHJlbikge1xuICAgIHBhcmVudCA9IHJlc29sdmUocGFyZW50KTtcbiAgICBjaGlsZHJlbiA9IHJlc29sdmUoY2hpbGRyZW4pO1xuICAgIGNvbnN0IHBhdGhzQSA9IHBhcmVudC5zcGxpdCgnLycpO1xuICAgIGNvbnN0IHBhdGhzQiA9IGNoaWxkcmVuLnNwbGl0KCcvJyk7XG4gICAgcmV0dXJuIChwYXJlbnQgIT09IGNoaWxkcmVuICYmXG4gICAgICAgIHBhdGhzQS5ldmVyeSgodmFsdWUsIGluZGV4KSA9PiB2YWx1ZSA9PT0gcGF0aHNCW2luZGV4XSkpO1xufVxuZXhwb3J0IGNsYXNzIEZpbGVzeXN0ZW1XZWIgZXh0ZW5kcyBXZWJQbHVnaW4ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLkRCX1ZFUlNJT04gPSAxO1xuICAgICAgICB0aGlzLkRCX05BTUUgPSAnRGlzYyc7XG4gICAgICAgIHRoaXMuX3dyaXRlQ21kcyA9IFsnYWRkJywgJ3B1dCcsICdkZWxldGUnXTtcbiAgICB9XG4gICAgYXN5bmMgaW5pdERiKCkge1xuICAgICAgICBpZiAodGhpcy5fZGIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RiO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKCdpbmRleGVkREInIGluIHdpbmRvdykpIHtcbiAgICAgICAgICAgIHRocm93IHRoaXMudW5hdmFpbGFibGUoXCJUaGlzIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IEluZGV4ZWREQlwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKHRoaXMuREJfTkFNRSwgdGhpcy5EQl9WRVJTSU9OKTtcbiAgICAgICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gRmlsZXN5c3RlbVdlYi5kb1VwZ3JhZGU7XG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9kYiA9IHJlcXVlc3QucmVzdWx0O1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgICAgICAgIHJlcXVlc3Qub25ibG9ja2VkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignZGIgYmxvY2tlZCcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBkb1VwZ3JhZGUoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgZXZlbnRUYXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGNvbnN0IGRiID0gZXZlbnRUYXJnZXQucmVzdWx0O1xuICAgICAgICBzd2l0Y2ggKGV2ZW50Lm9sZFZlcnNpb24pIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICBpZiAoZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucygnRmlsZVN0b3JhZ2UnKSkge1xuICAgICAgICAgICAgICAgICAgICBkYi5kZWxldGVPYmplY3RTdG9yZSgnRmlsZVN0b3JhZ2UnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgnRmlsZVN0b3JhZ2UnLCB7IGtleVBhdGg6ICdwYXRoJyB9KTtcbiAgICAgICAgICAgICAgICBzdG9yZS5jcmVhdGVJbmRleCgnYnlfZm9sZGVyJywgJ2ZvbGRlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGRiUmVxdWVzdChjbWQsIGFyZ3MpIHtcbiAgICAgICAgY29uc3QgcmVhZEZsYWcgPSB0aGlzLl93cml0ZUNtZHMuaW5kZXhPZihjbWQpICE9PSAtMSA/ICdyZWFkd3JpdGUnIDogJ3JlYWRvbmx5JztcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5pdERiKCkudGhlbigoY29ubikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0eCA9IGNvbm4udHJhbnNhY3Rpb24oWydGaWxlU3RvcmFnZSddLCByZWFkRmxhZyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnRmlsZVN0b3JhZ2UnKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXEgPSBzdG9yZVtjbWRdKC4uLmFyZ3MpO1xuICAgICAgICAgICAgICAgIHJlcS5vbnN1Y2Nlc3MgPSAoKSA9PiByZXNvbHZlKHJlcS5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlcS5vbmVycm9yID0gKCkgPT4gcmVqZWN0KHJlcS5lcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGRiSW5kZXhSZXF1ZXN0KGluZGV4TmFtZSwgY21kLCBhcmdzKSB7XG4gICAgICAgIGNvbnN0IHJlYWRGbGFnID0gdGhpcy5fd3JpdGVDbWRzLmluZGV4T2YoY21kKSAhPT0gLTEgPyAncmVhZHdyaXRlJyA6ICdyZWFkb25seSc7XG4gICAgICAgIHJldHVybiB0aGlzLmluaXREYigpLnRoZW4oKGNvbm4pID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHggPSBjb25uLnRyYW5zYWN0aW9uKFsnRmlsZVN0b3JhZ2UnXSwgcmVhZEZsYWcpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ0ZpbGVTdG9yYWdlJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBzdG9yZS5pbmRleChpbmRleE5hbWUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlcSA9IGluZGV4W2NtZF0oLi4uYXJncyk7XG4gICAgICAgICAgICAgICAgcmVxLm9uc3VjY2VzcyA9ICgpID0+IHJlc29sdmUocmVxLnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgcmVxLm9uZXJyb3IgPSAoKSA9PiByZWplY3QocmVxLmVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0UGF0aChkaXJlY3RvcnksIHVyaVBhdGgpIHtcbiAgICAgICAgY29uc3QgY2xlYW5lZFVyaVBhdGggPSB1cmlQYXRoICE9PSB1bmRlZmluZWQgPyB1cmlQYXRoLnJlcGxhY2UoL15bL10rfFsvXSskL2csICcnKSA6ICcnO1xuICAgICAgICBsZXQgZnNQYXRoID0gJyc7XG4gICAgICAgIGlmIChkaXJlY3RvcnkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIGZzUGF0aCArPSAnLycgKyBkaXJlY3Rvcnk7XG4gICAgICAgIGlmICh1cmlQYXRoICE9PSAnJylcbiAgICAgICAgICAgIGZzUGF0aCArPSAnLycgKyBjbGVhbmVkVXJpUGF0aDtcbiAgICAgICAgcmV0dXJuIGZzUGF0aDtcbiAgICB9XG4gICAgYXN5bmMgY2xlYXIoKSB7XG4gICAgICAgIGNvbnN0IGNvbm4gPSBhd2FpdCB0aGlzLmluaXREYigpO1xuICAgICAgICBjb25zdCB0eCA9IGNvbm4udHJhbnNhY3Rpb24oWydGaWxlU3RvcmFnZSddLCAncmVhZHdyaXRlJyk7XG4gICAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ0ZpbGVTdG9yYWdlJyk7XG4gICAgICAgIHN0b3JlLmNsZWFyKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWQgYSBmaWxlIGZyb20gZGlza1xuICAgICAqIEBwYXJhbSBvcHRpb25zIG9wdGlvbnMgZm9yIHRoZSBmaWxlIHJlYWRcbiAgICAgKiBAcmV0dXJuIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIHJlYWQgZmlsZSBkYXRhIHJlc3VsdFxuICAgICAqL1xuICAgIGFzeW5jIHJlYWRGaWxlKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuZ2V0UGF0aChvcHRpb25zLmRpcmVjdG9yeSwgb3B0aW9ucy5wYXRoKTtcbiAgICAgICAgLy8gY29uc3QgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nO1xuICAgICAgICBjb25zdCBlbnRyeSA9IChhd2FpdCB0aGlzLmRiUmVxdWVzdCgnZ2V0JywgW3BhdGhdKSk7XG4gICAgICAgIGlmIChlbnRyeSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ0ZpbGUgZG9lcyBub3QgZXhpc3QuJyk7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IGVudHJ5LmNvbnRlbnQgPyBlbnRyeS5jb250ZW50IDogJycgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV3JpdGUgYSBmaWxlIHRvIGRpc2sgaW4gdGhlIHNwZWNpZmllZCBsb2NhdGlvbiBvbiBkZXZpY2VcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zIGZvciB0aGUgZmlsZSB3cml0ZVxuICAgICAqIEByZXR1cm4gYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgZmlsZSB3cml0ZSByZXN1bHRcbiAgICAgKi9cbiAgICBhc3luYyB3cml0ZUZpbGUob3B0aW9ucykge1xuICAgICAgICBjb25zdCBwYXRoID0gdGhpcy5nZXRQYXRoKG9wdGlvbnMuZGlyZWN0b3J5LCBvcHRpb25zLnBhdGgpO1xuICAgICAgICBsZXQgZGF0YSA9IG9wdGlvbnMuZGF0YTtcbiAgICAgICAgY29uc3QgZW5jb2RpbmcgPSBvcHRpb25zLmVuY29kaW5nO1xuICAgICAgICBjb25zdCBkb1JlY3Vyc2l2ZSA9IG9wdGlvbnMucmVjdXJzaXZlO1xuICAgICAgICBjb25zdCBvY2N1cGllZEVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbcGF0aF0pKTtcbiAgICAgICAgaWYgKG9jY3VwaWVkRW50cnkgJiYgb2NjdXBpZWRFbnRyeS50eXBlID09PSAnZGlyZWN0b3J5JylcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdUaGUgc3VwcGxpZWQgcGF0aCBpcyBhIGRpcmVjdG9yeS4nKTtcbiAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGguc3Vic3RyKDAsIHBhdGgubGFzdEluZGV4T2YoJy8nKSk7XG4gICAgICAgIGNvbnN0IHBhcmVudEVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbcGFyZW50UGF0aF0pKTtcbiAgICAgICAgaWYgKHBhcmVudEVudHJ5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHN1YkRpckluZGV4ID0gcGFyZW50UGF0aC5pbmRleE9mKCcvJywgMSk7XG4gICAgICAgICAgICBpZiAoc3ViRGlySW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFyZW50QXJnUGF0aCA9IHBhcmVudFBhdGguc3Vic3RyKHN1YkRpckluZGV4KTtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm1rZGlyKHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogcGFyZW50QXJnUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5OiBvcHRpb25zLmRpcmVjdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlOiBkb1JlY3Vyc2l2ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWVuY29kaW5nKSB7XG4gICAgICAgICAgICBkYXRhID0gZGF0YS5pbmRleE9mKCcsJykgPj0gMCA/IGRhdGEuc3BsaXQoJywnKVsxXSA6IGRhdGE7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNCYXNlNjRTdHJpbmcoZGF0YSkpXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1RoZSBzdXBwbGllZCBkYXRhIGlzIG5vdCB2YWxpZCBiYXNlNjQgY29udGVudC4nKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCBwYXRoT2JqID0ge1xuICAgICAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgICAgIGZvbGRlcjogcGFyZW50UGF0aCxcbiAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcbiAgICAgICAgICAgIHNpemU6IGRhdGEubGVuZ3RoLFxuICAgICAgICAgICAgY3RpbWU6IG5vdyxcbiAgICAgICAgICAgIG10aW1lOiBub3csXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLFxuICAgICAgICB9O1xuICAgICAgICBhd2FpdCB0aGlzLmRiUmVxdWVzdCgncHV0JywgW3BhdGhPYmpdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVyaTogcGF0aE9iai5wYXRoLFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBlbmQgdG8gYSBmaWxlIG9uIGRpc2sgaW4gdGhlIHNwZWNpZmllZCBsb2NhdGlvbiBvbiBkZXZpY2VcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zIGZvciB0aGUgZmlsZSBhcHBlbmRcbiAgICAgKiBAcmV0dXJuIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIGZpbGUgd3JpdGUgcmVzdWx0XG4gICAgICovXG4gICAgYXN5bmMgYXBwZW5kRmlsZShvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmdldFBhdGgob3B0aW9ucy5kaXJlY3RvcnksIG9wdGlvbnMucGF0aCk7XG4gICAgICAgIGxldCBkYXRhID0gb3B0aW9ucy5kYXRhO1xuICAgICAgICBjb25zdCBlbmNvZGluZyA9IG9wdGlvbnMuZW5jb2Rpbmc7XG4gICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBwYXRoLnN1YnN0cigwLCBwYXRoLmxhc3RJbmRleE9mKCcvJykpO1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBsZXQgY3RpbWUgPSBub3c7XG4gICAgICAgIGNvbnN0IG9jY3VwaWVkRW50cnkgPSAoYXdhaXQgdGhpcy5kYlJlcXVlc3QoJ2dldCcsIFtwYXRoXSkpO1xuICAgICAgICBpZiAob2NjdXBpZWRFbnRyeSAmJiBvY2N1cGllZEVudHJ5LnR5cGUgPT09ICdkaXJlY3RvcnknKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1RoZSBzdXBwbGllZCBwYXRoIGlzIGEgZGlyZWN0b3J5LicpO1xuICAgICAgICBjb25zdCBwYXJlbnRFbnRyeSA9IChhd2FpdCB0aGlzLmRiUmVxdWVzdCgnZ2V0JywgW3BhcmVudFBhdGhdKSk7XG4gICAgICAgIGlmIChwYXJlbnRFbnRyeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCBzdWJEaXJJbmRleCA9IHBhcmVudFBhdGguaW5kZXhPZignLycsIDEpO1xuICAgICAgICAgICAgaWYgKHN1YkRpckluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudEFyZ1BhdGggPSBwYXJlbnRQYXRoLnN1YnN0cihzdWJEaXJJbmRleCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5ta2Rpcih7XG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IHBhcmVudEFyZ1BhdGgsXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdG9yeTogb3B0aW9ucy5kaXJlY3RvcnksXG4gICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWVuY29kaW5nICYmICF0aGlzLmlzQmFzZTY0U3RyaW5nKGRhdGEpKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1RoZSBzdXBwbGllZCBkYXRhIGlzIG5vdCB2YWxpZCBiYXNlNjQgY29udGVudC4nKTtcbiAgICAgICAgaWYgKG9jY3VwaWVkRW50cnkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKG9jY3VwaWVkRW50cnkuY29udGVudCAhPT0gdW5kZWZpbmVkICYmICFlbmNvZGluZykge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBidG9hKGF0b2Iob2NjdXBpZWRFbnRyeS5jb250ZW50KSArIGF0b2IoZGF0YSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IG9jY3VwaWVkRW50cnkuY29udGVudCArIGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdGltZSA9IG9jY3VwaWVkRW50cnkuY3RpbWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0aE9iaiA9IHtcbiAgICAgICAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAgICAgICBmb2xkZXI6IHBhcmVudFBhdGgsXG4gICAgICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgICAgICBzaXplOiBkYXRhLmxlbmd0aCxcbiAgICAgICAgICAgIGN0aW1lOiBjdGltZSxcbiAgICAgICAgICAgIG10aW1lOiBub3csXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLFxuICAgICAgICB9O1xuICAgICAgICBhd2FpdCB0aGlzLmRiUmVxdWVzdCgncHV0JywgW3BhdGhPYmpdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlIGEgZmlsZSBmcm9tIGRpc2tcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zIGZvciB0aGUgZmlsZSBkZWxldGVcbiAgICAgKiBAcmV0dXJuIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIGRlbGV0ZWQgZmlsZSBkYXRhIHJlc3VsdFxuICAgICAqL1xuICAgIGFzeW5jIGRlbGV0ZUZpbGUob3B0aW9ucykge1xuICAgICAgICBjb25zdCBwYXRoID0gdGhpcy5nZXRQYXRoKG9wdGlvbnMuZGlyZWN0b3J5LCBvcHRpb25zLnBhdGgpO1xuICAgICAgICBjb25zdCBlbnRyeSA9IChhd2FpdCB0aGlzLmRiUmVxdWVzdCgnZ2V0JywgW3BhdGhdKSk7XG4gICAgICAgIGlmIChlbnRyeSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ0ZpbGUgZG9lcyBub3QgZXhpc3QuJyk7XG4gICAgICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCB0aGlzLmRiSW5kZXhSZXF1ZXN0KCdieV9mb2xkZXInLCAnZ2V0QWxsS2V5cycsIFtcbiAgICAgICAgICAgIElEQktleVJhbmdlLm9ubHkocGF0aCksXG4gICAgICAgIF0pO1xuICAgICAgICBpZiAoZW50cmllcy5sZW5ndGggIT09IDApXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignRm9sZGVyIGlzIG5vdCBlbXB0eS4nKTtcbiAgICAgICAgYXdhaXQgdGhpcy5kYlJlcXVlc3QoJ2RlbGV0ZScsIFtwYXRoXSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGRpcmVjdG9yeS5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25zIGZvciB0aGUgbWtkaXJcbiAgICAgKiBAcmV0dXJuIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIG1rZGlyIHJlc3VsdFxuICAgICAqL1xuICAgIGFzeW5jIG1rZGlyKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuZ2V0UGF0aChvcHRpb25zLmRpcmVjdG9yeSwgb3B0aW9ucy5wYXRoKTtcbiAgICAgICAgY29uc3QgZG9SZWN1cnNpdmUgPSBvcHRpb25zLnJlY3Vyc2l2ZTtcbiAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGguc3Vic3RyKDAsIHBhdGgubGFzdEluZGV4T2YoJy8nKSk7XG4gICAgICAgIGNvbnN0IGRlcHRoID0gKHBhdGgubWF0Y2goL1xcLy9nKSB8fCBbXSkubGVuZ3RoO1xuICAgICAgICBjb25zdCBwYXJlbnRFbnRyeSA9IChhd2FpdCB0aGlzLmRiUmVxdWVzdCgnZ2V0JywgW3BhcmVudFBhdGhdKSk7XG4gICAgICAgIGNvbnN0IG9jY3VwaWVkRW50cnkgPSAoYXdhaXQgdGhpcy5kYlJlcXVlc3QoJ2dldCcsIFtwYXRoXSkpO1xuICAgICAgICBpZiAoZGVwdGggPT09IDEpXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignQ2Fubm90IGNyZWF0ZSBSb290IGRpcmVjdG9yeScpO1xuICAgICAgICBpZiAob2NjdXBpZWRFbnRyeSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ0N1cnJlbnQgZGlyZWN0b3J5IGRvZXMgYWxyZWFkeSBleGlzdC4nKTtcbiAgICAgICAgaWYgKCFkb1JlY3Vyc2l2ZSAmJiBkZXB0aCAhPT0gMiAmJiBwYXJlbnRFbnRyeSA9PT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1BhcmVudCBkaXJlY3RvcnkgbXVzdCBleGlzdCcpO1xuICAgICAgICBpZiAoZG9SZWN1cnNpdmUgJiYgZGVwdGggIT09IDIgJiYgcGFyZW50RW50cnkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50QXJnUGF0aCA9IHBhcmVudFBhdGguc3Vic3RyKHBhcmVudFBhdGguaW5kZXhPZignLycsIDEpKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMubWtkaXIoe1xuICAgICAgICAgICAgICAgIHBhdGg6IHBhcmVudEFyZ1BhdGgsXG4gICAgICAgICAgICAgICAgZGlyZWN0b3J5OiBvcHRpb25zLmRpcmVjdG9yeSxcbiAgICAgICAgICAgICAgICByZWN1cnNpdmU6IGRvUmVjdXJzaXZlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgcGF0aE9iaiA9IHtcbiAgICAgICAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAgICAgICBmb2xkZXI6IHBhcmVudFBhdGgsXG4gICAgICAgICAgICB0eXBlOiAnZGlyZWN0b3J5JyxcbiAgICAgICAgICAgIHNpemU6IDAsXG4gICAgICAgICAgICBjdGltZTogbm93LFxuICAgICAgICAgICAgbXRpbWU6IG5vdyxcbiAgICAgICAgfTtcbiAgICAgICAgYXdhaXQgdGhpcy5kYlJlcXVlc3QoJ3B1dCcsIFtwYXRoT2JqXSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIGRpcmVjdG9yeVxuICAgICAqIEBwYXJhbSBvcHRpb25zIHRoZSBvcHRpb25zIGZvciB0aGUgZGlyZWN0b3J5IHJlbW92ZVxuICAgICAqL1xuICAgIGFzeW5jIHJtZGlyKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgeyBwYXRoLCBkaXJlY3RvcnksIHJlY3Vyc2l2ZSB9ID0gb3B0aW9ucztcbiAgICAgICAgY29uc3QgZnVsbFBhdGggPSB0aGlzLmdldFBhdGgoZGlyZWN0b3J5LCBwYXRoKTtcbiAgICAgICAgY29uc3QgZW50cnkgPSAoYXdhaXQgdGhpcy5kYlJlcXVlc3QoJ2dldCcsIFtmdWxsUGF0aF0pKTtcbiAgICAgICAgaWYgKGVudHJ5ID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignRm9sZGVyIGRvZXMgbm90IGV4aXN0LicpO1xuICAgICAgICBpZiAoZW50cnkudHlwZSAhPT0gJ2RpcmVjdG9yeScpXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignUmVxdWVzdGVkIHBhdGggaXMgbm90IGEgZGlyZWN0b3J5Jyk7XG4gICAgICAgIGNvbnN0IHJlYWREaXJSZXN1bHQgPSBhd2FpdCB0aGlzLnJlYWRkaXIoeyBwYXRoLCBkaXJlY3RvcnkgfSk7XG4gICAgICAgIGlmIChyZWFkRGlyUmVzdWx0LmZpbGVzLmxlbmd0aCAhPT0gMCAmJiAhcmVjdXJzaXZlKVxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ0ZvbGRlciBpcyBub3QgZW1wdHknKTtcbiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiByZWFkRGlyUmVzdWx0LmZpbGVzKSB7XG4gICAgICAgICAgICBjb25zdCBlbnRyeVBhdGggPSBgJHtwYXRofS8ke2VudHJ5Lm5hbWV9YDtcbiAgICAgICAgICAgIGNvbnN0IGVudHJ5T2JqID0gYXdhaXQgdGhpcy5zdGF0KHsgcGF0aDogZW50cnlQYXRoLCBkaXJlY3RvcnkgfSk7XG4gICAgICAgICAgICBpZiAoZW50cnlPYmoudHlwZSA9PT0gJ2ZpbGUnKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5kZWxldGVGaWxlKHsgcGF0aDogZW50cnlQYXRoLCBkaXJlY3RvcnkgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJtZGlyKHsgcGF0aDogZW50cnlQYXRoLCBkaXJlY3RvcnksIHJlY3Vyc2l2ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLmRiUmVxdWVzdCgnZGVsZXRlJywgW2Z1bGxQYXRoXSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybiBhIGxpc3Qgb2YgZmlsZXMgZnJvbSB0aGUgZGlyZWN0b3J5IChub3QgcmVjdXJzaXZlKVxuICAgICAqIEBwYXJhbSBvcHRpb25zIHRoZSBvcHRpb25zIGZvciB0aGUgcmVhZGRpciBvcGVyYXRpb25cbiAgICAgKiBAcmV0dXJuIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIHJlYWRkaXIgZGlyZWN0b3J5IGxpc3RpbmcgcmVzdWx0XG4gICAgICovXG4gICAgYXN5bmMgcmVhZGRpcihvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHBhdGggPSB0aGlzLmdldFBhdGgob3B0aW9ucy5kaXJlY3RvcnksIG9wdGlvbnMucGF0aCk7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbcGF0aF0pKTtcbiAgICAgICAgaWYgKG9wdGlvbnMucGF0aCAhPT0gJycgJiYgZW50cnkgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdGb2xkZXIgZG9lcyBub3QgZXhpc3QuJyk7XG4gICAgICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCB0aGlzLmRiSW5kZXhSZXF1ZXN0KCdieV9mb2xkZXInLCAnZ2V0QWxsS2V5cycsIFtJREJLZXlSYW5nZS5vbmx5KHBhdGgpXSk7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgUHJvbWlzZS5hbGwoZW50cmllcy5tYXAoYXN5bmMgKGUpID0+IHtcbiAgICAgICAgICAgIGxldCBzdWJFbnRyeSA9IChhd2FpdCB0aGlzLmRiUmVxdWVzdCgnZ2V0JywgW2VdKSk7XG4gICAgICAgICAgICBpZiAoc3ViRW50cnkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHN1YkVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbZSArICcvJ10pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbmFtZTogZS5zdWJzdHJpbmcocGF0aC5sZW5ndGggKyAxKSxcbiAgICAgICAgICAgICAgICB0eXBlOiBzdWJFbnRyeS50eXBlLFxuICAgICAgICAgICAgICAgIHNpemU6IHN1YkVudHJ5LnNpemUsXG4gICAgICAgICAgICAgICAgY3RpbWU6IHN1YkVudHJ5LmN0aW1lLFxuICAgICAgICAgICAgICAgIG10aW1lOiBzdWJFbnRyeS5tdGltZSxcbiAgICAgICAgICAgICAgICB1cmk6IHN1YkVudHJ5LnBhdGgsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiB7IGZpbGVzOiBmaWxlcyB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gZnVsbCBGaWxlIFVSSSBmb3IgYSBwYXRoIGFuZCBkaXJlY3RvcnlcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyB0aGUgb3B0aW9ucyBmb3IgdGhlIHN0YXQgb3BlcmF0aW9uXG4gICAgICogQHJldHVybiBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSBmaWxlIHN0YXQgcmVzdWx0XG4gICAgICovXG4gICAgYXN5bmMgZ2V0VXJpKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuZ2V0UGF0aChvcHRpb25zLmRpcmVjdG9yeSwgb3B0aW9ucy5wYXRoKTtcbiAgICAgICAgbGV0IGVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbcGF0aF0pKTtcbiAgICAgICAgaWYgKGVudHJ5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbcGF0aCArICcvJ10pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXJpOiAoZW50cnkgPT09IG51bGwgfHwgZW50cnkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVudHJ5LnBhdGgpIHx8IHBhdGgsXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybiBkYXRhIGFib3V0IGEgZmlsZVxuICAgICAqIEBwYXJhbSBvcHRpb25zIHRoZSBvcHRpb25zIGZvciB0aGUgc3RhdCBvcGVyYXRpb25cbiAgICAgKiBAcmV0dXJuIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIGZpbGUgc3RhdCByZXN1bHRcbiAgICAgKi9cbiAgICBhc3luYyBzdGF0KG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuZ2V0UGF0aChvcHRpb25zLmRpcmVjdG9yeSwgb3B0aW9ucy5wYXRoKTtcbiAgICAgICAgbGV0IGVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbcGF0aF0pKTtcbiAgICAgICAgaWYgKGVudHJ5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbcGF0aCArICcvJ10pKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW50cnkgPT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdFbnRyeSBkb2VzIG5vdCBleGlzdC4nKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IGVudHJ5LnR5cGUsXG4gICAgICAgICAgICBzaXplOiBlbnRyeS5zaXplLFxuICAgICAgICAgICAgY3RpbWU6IGVudHJ5LmN0aW1lLFxuICAgICAgICAgICAgbXRpbWU6IGVudHJ5Lm10aW1lLFxuICAgICAgICAgICAgdXJpOiBlbnRyeS5wYXRoLFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW5hbWUgYSBmaWxlIG9yIGRpcmVjdG9yeVxuICAgICAqIEBwYXJhbSBvcHRpb25zIHRoZSBvcHRpb25zIGZvciB0aGUgcmVuYW1lIG9wZXJhdGlvblxuICAgICAqIEByZXR1cm4gYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgcmVuYW1lIHJlc3VsdFxuICAgICAqL1xuICAgIGFzeW5jIHJlbmFtZShvcHRpb25zKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuX2NvcHkob3B0aW9ucywgdHJ1ZSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29weSBhIGZpbGUgb3IgZGlyZWN0b3J5XG4gICAgICogQHBhcmFtIG9wdGlvbnMgdGhlIG9wdGlvbnMgZm9yIHRoZSBjb3B5IG9wZXJhdGlvblxuICAgICAqIEByZXR1cm4gYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgY29weSByZXN1bHRcbiAgICAgKi9cbiAgICBhc3luYyBjb3B5KG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcHkob3B0aW9ucywgZmFsc2UpO1xuICAgIH1cbiAgICBhc3luYyByZXF1ZXN0UGVybWlzc2lvbnMoKSB7XG4gICAgICAgIHJldHVybiB7IHB1YmxpY1N0b3JhZ2U6ICdncmFudGVkJyB9O1xuICAgIH1cbiAgICBhc3luYyBjaGVja1Blcm1pc3Npb25zKCkge1xuICAgICAgICByZXR1cm4geyBwdWJsaWNTdG9yYWdlOiAnZ3JhbnRlZCcgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdGhhdCBjYW4gcGVyZm9ybSBhIGNvcHkgb3IgYSByZW5hbWVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyB0aGUgb3B0aW9ucyBmb3IgdGhlIHJlbmFtZSBvcGVyYXRpb25cbiAgICAgKiBAcGFyYW0gZG9SZW5hbWUgd2hldGhlciB0byBwZXJmb3JtIGEgcmVuYW1lIG9yIGNvcHkgb3BlcmF0aW9uXG4gICAgICogQHJldHVybiBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSByZXN1bHRcbiAgICAgKi9cbiAgICBhc3luYyBfY29weShvcHRpb25zLCBkb1JlbmFtZSA9IGZhbHNlKSB7XG4gICAgICAgIGxldCB7IHRvRGlyZWN0b3J5IH0gPSBvcHRpb25zO1xuICAgICAgICBjb25zdCB7IHRvLCBmcm9tLCBkaXJlY3Rvcnk6IGZyb21EaXJlY3RvcnkgfSA9IG9wdGlvbnM7XG4gICAgICAgIGlmICghdG8gfHwgIWZyb20pIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdCb3RoIHRvIGFuZCBmcm9tIG11c3QgYmUgcHJvdmlkZWQnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBubyBcInRvXCIgZGlyZWN0b3J5IGlzIHByb3ZpZGVkLCB1c2UgdGhlIFwiZnJvbVwiIGRpcmVjdG9yeVxuICAgICAgICBpZiAoIXRvRGlyZWN0b3J5KSB7XG4gICAgICAgICAgICB0b0RpcmVjdG9yeSA9IGZyb21EaXJlY3Rvcnk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZnJvbVBhdGggPSB0aGlzLmdldFBhdGgoZnJvbURpcmVjdG9yeSwgZnJvbSk7XG4gICAgICAgIGNvbnN0IHRvUGF0aCA9IHRoaXMuZ2V0UGF0aCh0b0RpcmVjdG9yeSwgdG8pO1xuICAgICAgICAvLyBUZXN0IHRoYXQgdGhlIFwidG9cIiBhbmQgXCJmcm9tXCIgbG9jYXRpb25zIGFyZSBkaWZmZXJlbnRcbiAgICAgICAgaWYgKGZyb21QYXRoID09PSB0b1BhdGgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdXJpOiB0b1BhdGgsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc1BhdGhQYXJlbnQoZnJvbVBhdGgsIHRvUGF0aCkpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdUbyBwYXRoIGNhbm5vdCBjb250YWluIHRoZSBmcm9tIHBhdGgnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayB0aGUgc3RhdGUgb2YgdGhlIFwidG9cIiBsb2NhdGlvblxuICAgICAgICBsZXQgdG9PYmo7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0b09iaiA9IGF3YWl0IHRoaXMuc3RhdCh7XG4gICAgICAgICAgICAgICAgcGF0aDogdG8sXG4gICAgICAgICAgICAgICAgZGlyZWN0b3J5OiB0b0RpcmVjdG9yeSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBUbyBsb2NhdGlvbiBkb2VzIG5vdCBleGlzdCwgZW5zdXJlIHRoZSBkaXJlY3RvcnkgY29udGFpbmluZyBcInRvXCIgbG9jYXRpb24gZXhpc3RzIGFuZCBpcyBhIGRpcmVjdG9yeVxuICAgICAgICAgICAgY29uc3QgdG9QYXRoQ29tcG9uZW50cyA9IHRvLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICB0b1BhdGhDb21wb25lbnRzLnBvcCgpO1xuICAgICAgICAgICAgY29uc3QgdG9QYXRoID0gdG9QYXRoQ29tcG9uZW50cy5qb2luKCcvJyk7XG4gICAgICAgICAgICAvLyBDaGVjayB0aGUgY29udGFpbmluZyBkaXJlY3Rvcnkgb2YgdGhlIFwidG9cIiBsb2NhdGlvbiBleGlzdHNcbiAgICAgICAgICAgIGlmICh0b1BhdGhDb21wb25lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b1BhcmVudERpcmVjdG9yeSA9IGF3YWl0IHRoaXMuc3RhdCh7XG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IHRvUGF0aCxcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5OiB0b0RpcmVjdG9yeSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAodG9QYXJlbnREaXJlY3RvcnkudHlwZSAhPT0gJ2RpcmVjdG9yeScpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXJlbnQgZGlyZWN0b3J5IG9mIHRoZSB0byBwYXRoIGlzIGEgZmlsZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBDYW5ub3Qgb3ZlcndyaXRlIGEgZGlyZWN0b3J5XG4gICAgICAgIGlmICh0b09iaiAmJiB0b09iai50eXBlID09PSAnZGlyZWN0b3J5Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgb3ZlcndyaXRlIGEgZGlyZWN0b3J5IHdpdGggYSBmaWxlJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRW5zdXJlIHRoZSBcImZyb21cIiBvYmplY3QgZXhpc3RzXG4gICAgICAgIGNvbnN0IGZyb21PYmogPSBhd2FpdCB0aGlzLnN0YXQoe1xuICAgICAgICAgICAgcGF0aDogZnJvbSxcbiAgICAgICAgICAgIGRpcmVjdG9yeTogZnJvbURpcmVjdG9yeSxcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFNldCB0aGUgbXRpbWUvY3RpbWUgb2YgdGhlIHN1cHBsaWVkIHBhdGhcbiAgICAgICAgY29uc3QgdXBkYXRlVGltZSA9IGFzeW5jIChwYXRoLCBjdGltZSwgbXRpbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZ1bGxQYXRoID0gdGhpcy5nZXRQYXRoKHRvRGlyZWN0b3J5LCBwYXRoKTtcbiAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gKGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdnZXQnLCBbZnVsbFBhdGhdKSk7XG4gICAgICAgICAgICBlbnRyeS5jdGltZSA9IGN0aW1lO1xuICAgICAgICAgICAgZW50cnkubXRpbWUgPSBtdGltZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZGJSZXF1ZXN0KCdwdXQnLCBbZW50cnldKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgY3RpbWUgPSBmcm9tT2JqLmN0aW1lID8gZnJvbU9iai5jdGltZSA6IERhdGUubm93KCk7XG4gICAgICAgIHN3aXRjaCAoZnJvbU9iai50eXBlKSB7XG4gICAgICAgICAgICAvLyBUaGUgXCJmcm9tXCIgb2JqZWN0IGlzIGEgZmlsZVxuICAgICAgICAgICAgY2FzZSAnZmlsZSc6IHtcbiAgICAgICAgICAgICAgICAvLyBSZWFkIHRoZSBmaWxlXG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IHRoaXMucmVhZEZpbGUoe1xuICAgICAgICAgICAgICAgICAgICBwYXRoOiBmcm9tLFxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rvcnk6IGZyb21EaXJlY3RvcnksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gT3B0aW9uYWxseSByZW1vdmUgdGhlIGZpbGVcbiAgICAgICAgICAgICAgICBpZiAoZG9SZW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5kZWxldGVGaWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGZyb20sXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rvcnk6IGZyb21EaXJlY3RvcnksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBXcml0ZSB0aGUgZmlsZSB0byB0aGUgbmV3IGxvY2F0aW9uXG4gICAgICAgICAgICAgICAgY29uc3Qgd3JpdGVSZXN1bHQgPSBhd2FpdCB0aGlzLndyaXRlRmlsZSh7XG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IHRvLFxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rvcnk6IHRvRGlyZWN0b3J5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBmaWxlLmRhdGEsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgbXRpbWUvY3RpbWUgb2YgYSByZW5hbWVkIGZpbGVcbiAgICAgICAgICAgICAgICBpZiAoZG9SZW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlVGltZSh0bywgY3RpbWUsIGZyb21PYmoubXRpbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBSZXNvbHZlIHByb21pc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gd3JpdGVSZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdkaXJlY3RvcnknOiB7XG4gICAgICAgICAgICAgICAgaWYgKHRvT2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdDYW5ub3QgbW92ZSBhIGRpcmVjdG9yeSBvdmVyIGFuIGV4aXN0aW5nIG9iamVjdCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHRvIGRpcmVjdG9yeVxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm1rZGlyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IHRvLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5OiB0b0RpcmVjdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBtdGltZS9jdGltZSBvZiBhIHJlbmFtZWQgZGlyZWN0b3J5XG4gICAgICAgICAgICAgICAgICAgIGlmIChkb1JlbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlVGltZSh0bywgY3RpbWUsIGZyb21PYmoubXRpbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIGNvbnRlbnRzIG9mIHRoZSBmcm9tIGxvY2F0aW9uXG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudHMgPSAoYXdhaXQgdGhpcy5yZWFkZGlyKHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogZnJvbSxcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5OiBmcm9tRGlyZWN0b3J5LFxuICAgICAgICAgICAgICAgIH0pKS5maWxlcztcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGVuYW1lIG9mIGNvbnRlbnRzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgaXRlbSBmcm9tIHRoZSBmcm9tIGRpcmVjdG9yeSB0byB0aGUgdG8gZGlyZWN0b3J5XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX2NvcHkoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogYCR7ZnJvbX0vJHtmaWxlbmFtZX1gLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG86IGAke3RvfS8ke2ZpbGVuYW1lfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rvcnk6IGZyb21EaXJlY3RvcnksXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0RpcmVjdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgfSwgZG9SZW5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBPcHRpb25hbGx5IHJlbW92ZSB0aGUgb3JpZ2luYWwgZnJvbSBkaXJlY3RvcnlcbiAgICAgICAgICAgICAgICBpZiAoZG9SZW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5ybWRpcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBmcm9tLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5OiBmcm9tRGlyZWN0b3J5LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVyaTogdG9QYXRoLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBpc0Jhc2U2NFN0cmluZyhzdHIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBidG9hKGF0b2Ioc3RyKSkgPT0gc3RyO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbkZpbGVzeXN0ZW1XZWIuX2RlYnVnID0gdHJ1ZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXdlYi5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9